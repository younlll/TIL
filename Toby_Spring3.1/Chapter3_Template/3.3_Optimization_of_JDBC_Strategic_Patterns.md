# 3.3 JDBC ì „ëµ íŒ¨í„´ì˜ ìµœì í™”
## ì „ëµ í´ë˜ìŠ¤ì˜ ì¶”ê°€ ì •ë³´
* deleteAll()ì— ì ìš©í•œ ì „ëµíŒ¨í„´ì„ add() ë©”ì†Œë“œì—ë„ ì ìš©í•´ë³´ì

```java
public class AddStatement implements StatementStrategy {

  @Override
  public PreparedStatement makePreparedStatement(Connection conn) throws SQLException {
    PreparedStatement ps = conn.prepareStatement("insert into users(id, name, password) values (?, ?, ?)");
    ps.setString(1, user.getId());
    ps.setString(2, user.getName());
    ps.setString(3, user.getPassword());
    
    return ps;
  }
}
```

* ì•ì„œ 3.2ë¥¼ í•™ìŠµí•œ ë’¤ì— 3.3ì— add() ë©”ì†Œë“œì— ì „ëµíŒ¨í„´ ì ìš©í•˜ëŠ” ë‚´ìš©ì´ ìˆëŠ”ì§€ë¥¼ ëª¨ë¥´ê³  í˜¼ìì„œ ì ìš©í•´ë³´ë ¤ addë¥¼ í•˜ëŠ” classë¥¼ ìƒì„±í–ˆë‹¤
* ê·¸ ë’¤ì— StatementStrategyë¥¼ ë°›ì•„ì„œ Overrideë¥¼ í•˜ëŠ”ë°... userë¥¼ ì–´ë””ì—ì„œ ê°€ì ¸ì˜¤ì§€? í•˜ê³  ë©ˆì¶°ë²„ë ¸ë‹¤
* ë‹¹ì—°íˆ userë¼ëŠ” ê±¸ ì–´ë””ì—ì„  ì œê³µí•´ì¤˜ì•¼í•˜ëŠ”ë°...
* ì´ ê³ ë¯¼ì´ ìì—°ìŠ¤ëŸ¬ìš´ ê²ƒì¸ì§€ ì±…ì—ë„ ì„¤ëª…ì´ ë˜ì–´ìˆì—ˆë‹¤ğŸ˜…
* ë°”ë¡œ Insertë¥¼ ìœ„í•´ ë§Œë“  ì‹ ê·œ í´ë˜ìŠ¤ì˜ ìƒì„±ìë¥¼ í†µí•´ì„œ ë°›ëŠ”ë‹¤ëŠ” ê²ƒì´ì˜€ë‹¤
* íœ´.. ì•„ì§ ì˜í•˜ê¸° ìœ„í•´ì„œëŠ” ê°ˆ ê¸¸ì´ ë¨¼ë“¯í•˜ë‹¤

```java
public class AddStatement implements StatementStrategy {
  User user;
  
  public AddStatement(User user) {
    this.user = user;
  }
}

@Override
public PreparedStatement makePreparedStatement(Connection conn) {
  PreparedStatement ps = conn.prepareStatement("insert into users(id, name, password) values (?, ?, ?)");
  
  ps.setString(1, user.getId());
  ps.setString(2, user.getName());
  ps.setString(3, user.getPassword());
  
  return ps;
}

```

</br>

## ì „ëµê³¼ í´ë¼ì´ì–¸íŠ¸ì˜ ë™ê±°
**ë¶ˆí¸í•œ ì **
1. DAO ë©”ì†Œë“œë§ˆë‹¤ ìƒˆë¡œìš´ StatementStrategy êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤
2. DAO ë©”ì†Œë“œì— ë¶€ê°€ì ìœ¼ë¡œ ì „ë‹¬í•  ì •ë³´ê°€ ìˆëŠ” ê²½ìš°, ì´ë¥¼ ìœ„í•´ ì˜¤ë¸Œì íŠ¸ë¥¼ ì „ë‹¬ë°›ëŠ” ìƒì„±ìì™€ ì´ë¥¼ ì €ì¥í•  ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ì•¼í•œë‹¤

####  ì¤‘ì²© í´ë˜ìŠ¤
* `ì¤‘ì²© í´ë˜ìŠ¤`ë€ ë‹¤ë¥¸ í´ë˜ìŠ¤ ë‚´ë¶€ì— ì •ì˜ë˜ëŠ” í´ë˜ìŠ¤

1. ë©¤ë²„ í•„ë“œì²˜ëŸ¼ ì˜¤ë¸Œì íŠ¸ ë ˆë²¨ì— ì •ì˜ë˜ëŠ” ë©¤ë²„ ë‚´ë¶€ í´ë˜ìŠ¤
2. ë©”ì†Œë“œ ë ˆë²¨ì— ì •ì˜ë˜ëŠ” ë¡œì»¬ í´ë˜ìŠ¤
3. ì´ë¦„ì„ ê°–ì§€ ì•ŠëŠ” ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤
  * í´ë˜ìŠ¤ë¥¼ ì¬ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ê³  êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ íƒ€ì…ìœ¼ë¡œë§Œ ì‚¬ìš©í•  ê²½ìš° ìœ ìš©í•˜ë‹¤
  * `new interface_name() { class content };`


### ë¡œì»¬ í´ë˜ìŠ¤
```java
public void add(User user) throws SQLException {
  class AddStatement implements StatementStategy {
    User user;
    
    public AddStatement(User user) {
      this.user = user;
    }
    
    public PreparedStatement makePreparedStatement(Connection conn) throws SQLException {
      PreparedStatement ps = conn.preparedStatement("insert into users (id, name, password) values (?, ?, ?)");
      ps.setString(1, user.getId());
      ps.setString(2, user.getName());
      ps.setString(3, user.getPassword());
      
      return ps;
    }
  }
  
  StatementStrategy st = new AddStatement(user);
  jdbcContextWithStatementStrategy(st);
}
```

* ìœ„ì²˜ëŸ¼ êµ¬í˜„í•˜ê²Œ ë˜ë©´ í´ë˜ìŠ¤ íŒŒì¼ì´ í•˜ë‚˜ ì¤„ê³  add() ë©”ì†Œë“œ ì•ˆì—ì„œ PreparedStatement ìƒì„± ë¡œì§ì„ í•¨ê»˜ ë³¼ ìˆ˜ ìˆì–´ ì½”ë“œ ì´í•´ê°€ ì¢‹ë‹¤
* ë¡œì»¬ í´ë˜ìŠ¤ëŠ” í´ë˜ìŠ¤ê°€ ë‚´ë¶€ í´ë˜ìŠ¤ì´ê¸° ë•Œë¬¸ì— ìì‹ ì´ ì„ ì–¸ëœ ê³³ì˜ ì •ë³´ì— ì ‘ê·¼ í•  ìˆ˜ ìˆë‹¤
* í•˜ì§€ë§Œ ì´ë ‡ê²Œ add() ë©”ì†Œë“œ ë‚´ì— AddStatement í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ë©´ ë²ˆê±°ë¡­ê²Œ ìƒì„±ìë¥¼ í†µí•´ User ì˜¤ë¸Œì íŠ¸ë¥¼ ì „ë‹¬í•´ì¤„ í•„ìš”ê°€ ì—†ë‹¤

* ë‚´ë¶€ ë©”ì†Œë“œëŠ” ìì‹ ì´ ì •ì˜ëœ ë©”ì†Œë“œì˜ ë¡œì»¬ ë³€ìˆ˜ì— ì§ì ‘ ì ‘ê·¼ í•  ìˆ˜ê°€ ìˆê¸° ë•Œë¬¸ì—
* ë©”ì†Œë“œ íŒŒë¼ë¯¸í„°ë„ ì¼ì¢…ì˜ ë¡œì»¬ë³€ìˆ˜ ì´ë¯€ë¡œ add() ë©”ì†Œë“œì˜ userë³€ìˆ˜ë¥¼ AddStatementì—ì„œ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤
* ë‚´ë¶€ í´ë˜ìŠ¤ì—ì„œ ì™¸ë¶€ì˜ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì™¸ë¶€ ë³€ìˆ˜ëŠ” ë°˜ë“œì‹œ finalë¡œ ì„ ì–¸í•´ì¤˜ì•¼ í•œë‹¤

```java
public void add(final User user) throws SQLException {
  class AddStatement implements StatementStrategy {
    public PreparedStatement makePreparedStatement(Connection conn) throws SQLException {
      PreparedStatement ps = conn.prepareStatement("insert into users(id, name, password) values (?, ?, ?)");
      ps.setString(1, user.getId());
      ps.setString(2, user.getName());
      ps.setString(3, user.getPassword());
      
      return ps;
    }
  }
  
  StatementStrategy st = new AddStatement();
  jdbcContexWithStatementStrategy(st);
}
```

* í´ë˜ìŠ¤ë¥¼ í•˜ë‚˜ë¡œ ì¤„ì´ê³  ë‚´ë¶€ í´ë˜ìŠ¤ì˜ íŠ¹ì§•ì„ ì´ìš©í•´ ë¡œì»¬ ë³€ìˆ˜ë¥¼ ë°”ë¡œ ê°€ì ¸ë‹¤ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ìœ¼ë¡œ ì¢‹ê²Œ ë³€í™”ë¥¼ ì£¼ì—ˆë‹¤
* í•˜ì§€ë§Œ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ í†µí•´ ì´ë¦„ë„ ì œê±° í•˜ì—¬ ì‚¬ìš©í•´ë³´ì

### ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤
```java
StatementStrategy st = new StatementStrategy() {
  public PreparedStatement makePreparedStatement(Connection conn) throws SQLException {
    PreparedStatement ps = conn.prepareStatement("insert into users(id, name, password) values (?, ?, ?)");
    ps.setString(1, user.getId());
    ps.setString(2, user.getName());
    ps.setString(3, user.getPassword());
    
    return ps;
  }
};
```

* ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ ì˜¤ë¸Œì íŠ¸ëŠ” ë”± í•œë²ˆ ì‚¬ìš©í•  ê²ƒì´ë¯€ë¡œ jdbcContextWithStatementStrategy() ë©”ì†Œë“œì˜ íŒŒë¼ë¯¸í„°ì—ì„œ ë°”ë¡œ ìƒì„±í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤

```java
public void add(final User user) throws SQLException {
  jdbcContextWithStatementStrategy(
    new StatementStrategy() {
      public PreparedStatement makePreparedStatement(Connection conn) throws SQLException {
        PreparedStatement ps = conn.prepareStatement("insert into users(id, name, password) values (?, ?, ?)");
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());
        
        return ps;
      }
    }
  );
}

public void deleteAll() throws SQLException {
  jdbcContextWithStatementStrategy(
    new StatementStrategy() {
      public PreparedStatement makePreparedStatement(Connection conn) throws SQLException {
        return conn.prepareStatement("delete from users");
      }
    }
  );
}
```
